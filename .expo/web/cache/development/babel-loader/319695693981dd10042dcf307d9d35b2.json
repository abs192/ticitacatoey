{"ast":null,"code":"import _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nvar _jsxFileName = \"C:\\\\Users\\\\adish\\\\Documents\\\\GitHub\\\\ticitacatoey\\\\screens\\\\GameScreen.tsx\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { Component } from 'react';\nimport Text from \"react-native-web/dist/exports/Text\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Grid from \"../components/grid\";\nimport ToastModal from \"../components/modals/ToastModal\";\nimport { Game, MessageTypes } from \"../game/model\";\nimport QRCodeGen from 'react-native-qrcode-generator';\nimport TModal from \"../components/modal\";\n\nvar GameManager = function () {\n  function GameManager() {\n    _classCallCheck(this, GameManager);\n\n    this.EMPTY = \" \";\n    this.game = new Game();\n    this.xo = \"x\";\n  }\n\n  _createClass(GameManager, [{\n    key: \"onMessage\",\n    value: function onMessage(obj) {\n      switch (obj.type) {\n        case MessageTypes.REGISTER_PLAYER:\n          {\n            this.playerId = obj.playerId;\n            console.log('registerd ' + obj.playerId);\n            this.onRegisterSuccess();\n            break;\n          }\n\n        case MessageTypes.START_GAME:\n          {\n            this.playerId = obj.playerId;\n            console.log('game started ' + obj.playerId);\n            break;\n          }\n\n        case MessageTypes.MAKE_MOVE:\n          {\n            break;\n          }\n\n        case MessageTypes.JOIN_GAME:\n          {\n            break;\n          }\n      }\n    }\n  }, {\n    key: \"makeMove\",\n    value: function makeMove(data, key, callback) {\n      var legalMove = false;\n\n      if (data[key] == this.EMPTY) {\n        legalMove = true;\n      }\n\n      if (legalMove) {\n        callback(this.xo);\n        this.switchMove();\n      }\n    }\n  }, {\n    key: \"registerPlayer\",\n    value: function registerPlayer(ws, player, onSuccess) {\n      this.onRegisterSuccess = onSuccess;\n      var msg = JSON.stringify(_objectSpread({\n        type: MessageTypes.REGISTER_PLAYER\n      }, player));\n      console.log(\"registering msg: \" + msg);\n      ws.send(msg);\n    }\n  }, {\n    key: \"startGame\",\n    value: function startGame(ws, startGameInput) {\n      var msg = JSON.stringify(_objectSpread({\n        type: MessageTypes.START_GAME\n      }, startGameInput));\n      console.log(\"registering msg: \" + msg);\n      ws.send(msg);\n    }\n  }, {\n    key: \"switchMove\",\n    value: function switchMove() {\n      if (this.xo == \"x\") {\n        this.xo = \"o\";\n      } else {\n        this.xo = \"x\";\n      }\n    }\n  }]);\n\n  return GameManager;\n}();\n\nvar GameScreen = function (_Component) {\n  _inherits(GameScreen, _Component);\n\n  var _super = _createSuper(GameScreen);\n\n  function GameScreen(props) {\n    var _this;\n\n    _classCallCheck(this, GameScreen);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      data: [\" \", \" \", \" \", \" \", \" \", \" \", \" \", \" \", \" \"],\n      playerName: \"abs\",\n      isLoading: false,\n      showQR: true,\n      socketOpen: false,\n      gameStarted: true,\n      socketConnected: false,\n      isOnlineGame: true,\n      updated: true,\n      isYourMove: true,\n      scanned: false,\n      requestGame: _this.props.startGame\n    };\n    _this.gameManager = new GameManager();\n    _this.onSquareClicked = _this.onSquareClicked.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(GameScreen, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      console.log('mount');\n\n      if (this.state.isOnlineGame) {\n        console.log('yes');\n        this.socket = new WebSocket('ws://192.168.1.8:8080');\n\n        this.socket.onopen = function () {\n          console.log('ws open');\n          var player = {\n            name: _this2.state.playerName\n          };\n\n          _this2.gameManager.registerPlayer(_this2.socket, player, function () {\n            var startGameInput = {\n              name: _this2.state.playerName,\n              boardSize: 3,\n              playerCount: 2\n            };\n\n            _this2.gameManager.startGame(_this2.socket);\n          });\n        };\n\n        this.socket.onerror = function (_ref) {\n          var data = _ref.data;\n          return console.log('ws error');\n        };\n\n        this.socket.onmessage = function (_ref2) {\n          var data = _ref2.data;\n          console.log(\"on message \" + data + \" | \" + JSON.parse(data));\n\n          try {\n            _this2.gameManager.onMessage(JSON.parse(data));\n          } catch (Exception) {}\n        };\n      }\n    }\n  }, {\n    key: \"startNewGame\",\n    value: function startNewGame() {}\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      console.log('update');\n    }\n  }, {\n    key: \"onSquareClicked\",\n    value: function onSquareClicked(key) {\n      var _this3 = this;\n\n      if (this.state.gameStarted && this.state.isYourMove) {\n        this.gameManager.makeMove(this.state.data, key, function (xo) {\n          var d = _this3.state.data;\n          d[key] = xo;\n\n          _this3.setState({\n            data: d\n          });\n        });\n      }\n\n      console.log(this.state.data);\n    }\n  }, {\n    key: \"updateYourMove\",\n    value: function updateYourMove(isItReally) {\n      this.setState({\n        isYourMove: isItReally\n      });\n    }\n  }, {\n    key: \"handleBarCodeScanned\",\n    value: function handleBarCodeScanned(type, data) {\n      this.setState({\n        scanned: true\n      });\n      alert(\"Bar code with type \" + type + \" and data \" + data + \" has been scanned!\");\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return React.createElement(View, {\n        style: styles.container,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 13\n        }\n      }, React.createElement(ToastModal, {\n        isLoading: this.state.isLoading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 17\n        }\n      }), React.createElement(TModal, {\n        animationType: \"fade\",\n        visible: this.state.showQR,\n        transparent: true,\n        dismiss: function dismiss() {\n          _this4.setState({\n            showQR: false\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 17\n        }\n      }, React.createElement(View, {\n        style: styles.qrCodeModal,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 21\n        }\n      }, React.createElement(QRCodeGen, {\n        value: \"abc\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 25\n        }\n      }), React.createElement(Text, {\n        style: styles.qrCodeText,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 25\n        }\n      }, \"Scan this QR Code on your friend's app to join\"))), React.createElement(Grid, {\n        size: 3,\n        data: this.state.data,\n        onGridSquarePressed: function onGridSquarePressed(key) {\n          return _this4.onSquareClicked(key);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 17\n        }\n      }));\n    }\n  }]);\n\n  return GameScreen;\n}(Component);\n\nexport default GameScreen;\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#ddd',\n    flexDirection: 'column'\n  },\n  qrCodeModal: {\n    flexDirection: 'row',\n    margin: 20,\n    padding: 20,\n    justifyContent: \"center\",\n    backgroundColor: \"#fff\",\n    borderRadius: 20,\n    shadowOffset: {\n      width: 0,\n      height: 2\n    },\n    shadowOpacity: 0.25,\n    shadowRadius: 3.84,\n    elevation: 5,\n    opacity: 1\n  },\n  qrCodeText: {\n    flex: 1,\n    margin: 15,\n    fontWeight: 'bold',\n    fontSize: 24,\n    flexWrap: 'wrap'\n  }\n});","map":{"version":3,"sources":["C:/Users/adish/Documents/GitHub/ticitacatoey/screens/GameScreen.tsx"],"names":["React","Component","Grid","ToastModal","Game","MessageTypes","QRCodeGen","TModal","GameManager","EMPTY","game","xo","obj","type","REGISTER_PLAYER","playerId","console","log","onRegisterSuccess","START_GAME","MAKE_MOVE","JOIN_GAME","data","key","callback","legalMove","switchMove","ws","player","onSuccess","msg","JSON","stringify","send","startGameInput","GameScreen","props","state","playerName","isLoading","showQR","socketOpen","gameStarted","socketConnected","isOnlineGame","updated","isYourMove","scanned","requestGame","startGame","gameManager","onSquareClicked","bind","socket","WebSocket","onopen","name","registerPlayer","boardSize","playerCount","onerror","onmessage","parse","onMessage","Exception","makeMove","d","setState","isItReally","alert","styles","container","qrCodeModal","qrCodeText","StyleSheet","create","flex","backgroundColor","flexDirection","margin","padding","justifyContent","borderRadius","shadowOffset","width","height","shadowOpacity","shadowRadius","elevation","opacity","fontWeight","fontSize","flexWrap"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Text, StyleSheet, View } from 'react-native';\r\nimport Grid from '../components/grid';\r\nimport ToastModal from '../components/modals/ToastModal';\r\nimport { Game, Player, MessageTypes } from '../game/model';\r\nimport QRCodeGen from 'react-native-qrcode-generator';\r\nimport TModal from '../components/modal';\r\nimport { BarCodeScanner } from 'expo-barcode-scanner';\r\n\r\nclass GameManager {\r\n\r\n    EMPTY = \" \"\r\n\r\n    constructor() {\r\n        this.game = new Game()\r\n        this.xo = \"x\"\r\n    }\r\n\r\n    onMessage(obj) {\r\n        switch (obj.type) {\r\n            case MessageTypes.REGISTER_PLAYER:\r\n                {\r\n                    this.playerId = obj.playerId;\r\n                    console.log('registerd ' + obj.playerId);\r\n                    this.onRegisterSuccess()\r\n                    break;\r\n                }\r\n            case MessageTypes.START_GAME:\r\n                {\r\n                    this.playerId = obj.playerId;\r\n                    console.log('game started ' + obj.playerId);\r\n                    break;\r\n                }\r\n            case MessageTypes.MAKE_MOVE:\r\n                {\r\n\r\n                    break;\r\n                }\r\n            case MessageTypes.JOIN_GAME: {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    makeMove(data, key, callback) {\r\n        let legalMove = false\r\n\r\n        if (data[key] == this.EMPTY) {\r\n            legalMove = true\r\n        }\r\n\r\n        if (legalMove) {\r\n            callback(this.xo)\r\n            this.switchMove()\r\n        }\r\n    }\r\n\r\n    registerPlayer(ws, player, onSuccess) {\r\n        this.onRegisterSuccess = onSuccess\r\n        let msg = JSON.stringify({ type: MessageTypes.REGISTER_PLAYER, ...player })\r\n        console.log(\"registering msg: \" + msg)\r\n        ws.send(msg)\r\n    }\r\n\r\n    startGame(ws, startGameInput) {\r\n        let msg = JSON.stringify({ type: MessageTypes.START_GAME, ...startGameInput })\r\n        console.log(\"registering msg: \" + msg)\r\n        ws.send(msg)\r\n    }\r\n\r\n    switchMove() {\r\n        if (this.xo == \"x\") {\r\n            this.xo = \"o\";\r\n        } else {\r\n            this.xo = \"x\";\r\n        }\r\n    }\r\n}\r\n\r\nclass GameScreen extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            data: [\" \", \" \", \" \", \" \", \" \", \" \", \" \", \" \", \" \",],\r\n            playerName: \"abs\",// get from props later\r\n            isLoading: false,\r\n            showQR: true,\r\n            socketOpen: false,\r\n            gameStarted: true,\r\n            socketConnected: false,\r\n            // isOnlineGame: this.props.isOnlineGame,\r\n            isOnlineGame: true,\r\n            updated: true,\r\n            isYourMove: true,\r\n            scanned: false,\r\n            requestGame: this.props.startGame,\r\n        };\r\n\r\n        this.gameManager = new GameManager()\r\n        this.onSquareClicked = this.onSquareClicked.bind(this)\r\n    }\r\n\r\n    componentDidMount() {\r\n        console.log('mount')\r\n        if (this.state.isOnlineGame) {\r\n            console.log('yes')\r\n            this.socket = new WebSocket('ws://192.168.1.8:8080')\r\n            this.socket.onopen = () => {\r\n                console.log('ws open')\r\n                let player = {\r\n                    name: this.state.playerName\r\n                }\r\n                this.gameManager.registerPlayer(this.socket, player, () => {\r\n                    let startGameInput = {\r\n                        name: this.state.playerName,\r\n                        boardSize: 3,\r\n                        playerCount: 2,\r\n                    }\r\n                    this.gameManager.startGame(this.socket,)\r\n                })\r\n            }\r\n            this.socket.onerror = ({ data }) => console.log('ws error')\r\n            this.socket.onmessage = ({ data }) => {\r\n                console.log(\"on message \" + data + \" | \" + JSON.parse(data))\r\n                try {\r\n                    this.gameManager.onMessage(JSON.parse(data))\r\n                } catch (Exception) {\r\n\r\n                }\r\n            }\r\n        }\r\n\r\n        // (async () => {\r\n        //     const { status } = await BarCodeScanner.requestPermissionsAsync();\r\n        //     this.setState({\r\n        //         scanned:\r\n        //             (status === 'granted')\r\n        //     })\r\n        // })\r\n    }\r\n\r\n    startNewGame() {\r\n\r\n    }\r\n\r\n\r\n    componentDidUpdate() {\r\n        console.log('update')\r\n    }\r\n\r\n    onSquareClicked(key) {\r\n        if (this.state.gameStarted && this.state.isYourMove) {\r\n            this.gameManager.makeMove(this.state.data, key, (xo) => {\r\n                var d = this.state.data\r\n                d[key] = xo\r\n                this.setState({\r\n                    data: d\r\n                })\r\n            })\r\n        }\r\n        console.log(this.state.data)\r\n    }\r\n\r\n    updateYourMove(isItReally) {\r\n        this.setState({\r\n            isYourMove: isItReally\r\n        })\r\n    }\r\n\r\n    handleBarCodeScanned(type, data) {\r\n        this.setState({ scanned: true });\r\n        alert(`Bar code with type ${type} and data ${data} has been scanned!`);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <View style={styles.container}>\r\n                <ToastModal isLoading={this.state.isLoading} />\r\n                {/* <BarCodeScanner\r\n                    onBarCodeScanned={this.state.scanned ? undefined : this.handleBarCodeScanned}\r\n                    style={StyleSheet.absoluteFillObject}\r\n                />\r\n\r\n                {this.state.scanned && (\r\n                    <Button title={'Tap to Scan Again'} onPress={() => this.setState({ scanned: false })} />\r\n                )} */}\r\n\r\n                <TModal animationType='fade' visible={this.state.showQR} transparent={true} dismiss={() => { this.setState({ showQR: false }) }}>\r\n                    <View style={styles.qrCodeModal}>\r\n                        <QRCodeGen value=\"abc\" />\r\n                        <Text style={styles.qrCodeText}>Scan this QR Code on your friend's app to join</Text>\r\n                    </View>\r\n                </TModal>\r\n                {/* <ToastModal isLoading={this.state.isLoading} /> */}\r\n                <Grid size={3} data={this.state.data} onGridSquarePressed={(key) => this.onSquareClicked(key)} />\r\n            </View >\r\n        )\r\n    }\r\n}\r\n\r\nexport default GameScreen;\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        backgroundColor: '#ddd',\r\n        flexDirection: 'column',\r\n    },\r\n    qrCodeModal: {\r\n        flexDirection: 'row',\r\n        margin: 20,\r\n        padding: 20,\r\n        justifyContent: \"center\",\r\n        backgroundColor: \"#fff\",\r\n        borderRadius: 20,\r\n        shadowOffset: {\r\n            width: 0,\r\n            height: 2\r\n        },\r\n        shadowOpacity: 0.25,\r\n        shadowRadius: 3.84,\r\n        elevation: 5,\r\n        opacity: 1,\r\n    },\r\n    qrCodeText: {\r\n        flex: 1,\r\n        margin: 15,\r\n        fontWeight: 'bold',\r\n        fontSize: 24,\r\n        flexWrap: 'wrap',\r\n    },\r\n});\r\n"]},"metadata":{},"sourceType":"module"}